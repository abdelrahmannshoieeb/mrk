const u={attributeName:"data-search-uuid",init(){const t="search-uuid",e=()=>{try{const r=localStorage.getItem(t);if(!r)return;const n=new Date().getTime(),{uuid:c,timestamp:s}=JSON.parse(r);n-s<1e4&&this.set(c)}catch(r){console.error("Error extracting UUID from storage",r)}finally{localStorage.removeItem(t)}},a=r=>{if(!r.target.closest("[data-uuid-passthrough]"))return;const n=this.get(r.target);if(!n)return;const c={uuid:n,timestamp:new Date().getTime()};localStorage.setItem(t,JSON.stringify(c))},i=r=>{const n=this.get(r.target);n&&this.set(n)};document.addEventListener("click",r=>{i(r),a(r)},!0),e()},set(t,e=null){const a=e||document.querySelector("body");a==null||a.setAttribute(this.attributeName,t)},get(t=null){var a;const e=t||document.querySelector("body");return e?(a=e.closest(`[${this.attributeName}]`))==null?void 0:a.getAttribute(this.attributeName):""},clear(t=null){t&&t.removeAttribute(this.attributeName)}},d=(t,e={})=>{t&&(window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:t,...e}))},h={getCSRFToken(){const t=document.querySelector('meta[name="csrf-token"]');return(t==null?void 0:t.getAttribute("content"))||""},getABTestValues(){const t=document.querySelectorAll("drb-ab-test"),e={};return t.forEach(a=>{const i=a.getAttribute("name"),r=a.getAttribute("value");i&&r&&(e[i]=r)}),e},trackAdClicked(t){return this.trackInternally("AdClicked",t)},trackAdRequestFailed(t){return this.trackInternally("AdRequestFailed",t)},trackAdRequested(t){return this.trackInternally("AdRequested",t)},trackAdServed(t){return this.trackInternally("AdServed",t)},trackAdExpanded(t){return this.trackInternally("AdExpanded",t)},trackAdCollapsed(t){return this.trackInternally("AdCollapsed",t)},trackAdDismissed(t){return this.trackInternally("AdDismissed",t)},trackCheckoutViewed(t){return this.trackInternally("CheckoutViewed",t)},trackCTAClicked(t){return this.trackInternally("CTAClicked",t)},trackContactInfoWarningShown(t){return this.trackInternally("ContactInfoWarningShown",t)},trackInternally(t,e){const a={page_url:window.location.href};return fetch("/client_app/events",{body:JSON.stringify({event:{name:t,payload:{...a,...e}}}),headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCSRFToken()},method:"POST"})},bindGlobalListeners(){const t=e=>{var r;const a=(r=e.target)==null?void 0:r.closest("[data-internal-track-cta]");if(!a)return;const i={subject_id:a.getAttribute("data-internal-subject-id")||"",subject_type:a.getAttribute("data-internal-subject-type")||"",name:a.getAttribute("data-internal-track-cta")||a.textContent.trim()};this.trackCTAClicked(i)};document.addEventListener("click",e=>{t(e)})},bindGlobalSearchActivityListeners(){const t=r=>{var o;const n=r.target.closest(".js-contact-overlay-trigger"),c=r.target.closest("[data-message-dialog-button]");if(!(!!n||!!c))return;const l=(o=r.target.closest("[data-message-recipient]"))==null?void 0:o.getAttribute("data-message-recipient");l&&(this.trackSearchMessageCTAClicked(l,r.target),d("MessageCTAClicked",{userID:l}))},e=r=>{var c;const n=(c=r.target.closest("[data-search-profile-clicked]"))==null?void 0:c.getAttribute("data-search-profile-clicked");n&&(this.trackSearchProfileClicked(n,r.target),d("ProfileClicked",{userID:n}))},a=r=>{var c;const n=(c=r.target.closest("[data-search-service-clicked]"))==null?void 0:c.getAttribute("data-search-service-clicked");n&&this.trackSearchServiceClicked(n,r.target)},i=r=>{var c;const n=(c=r.target.closest("[data-shot-thumbnail-link]"))==null?void 0:c.getAttribute("data-shot-thumbnail-link");n&&this.trackSearchShotClicked(n,r.target)};document.addEventListener("click",r=>{t(r),e(r),a(r),i(r)},!0),document.addEventListener("auxclick",r=>{r.button===1&&(e(r),a(r))},!0),Dribbble.EventBus.$on("shotViewRecorder:shotsSeen",r=>{if(!r||r.length===0)return;const n=Array.from(r).reduce((c,s)=>{const l=document.querySelector(`[data-shot-thumbnail-link="${s}"]`);if(!l)return c;const o=u.get(l);return c[o]||(c[o]=[]),c[o].push(s),c},{});Object.entries(n).forEach(([c,s])=>{this.trackSearchShotsSeen(s,c)})})},trackSearchUserMessaged(t,e=null){return this.trackSearchActivity({target:t,target_type:"User",name:"UserMessaged"},e)},trackSearchMessageCTAClicked(t,e=null){return this.trackSearchActivity({target:t,target_type:"User",name:"MessageCTAClicked"},e)},trackSearchMessageModalDisplayed(t,e=null){return this.trackSearchActivity({target:t,target_type:"User",name:"MessageModalDisplayed"},e)},trackSearchShotClicked(t,e=null){return this.trackSearchActivity({target:t,target_type:"Screenshot",name:"ShotClicked"},e)},trackSearchServiceClicked(t,e=null){return this.trackSearchActivity({target:t,target_type:"ServiceOffering",name:"ServiceClicked"},e)},trackSearchShotLiked(t,e=null){return this.trackSearchActivity({target:t,target_type:"Screenshot",name:"ShotLiked"},e)},trackSearchShotSaved(t,e=null){return this.trackSearchActivity({target:t,target_type:"Screenshot",name:"ShotSaved"},e)},trackSearchUserFollowed(t,e=null){return this.trackSearchActivity({target:t,target_type:"User",name:"UserFollowed"},e)},trackSearchShotsSeen(t,e){if(!t||t.length===0)return null;const a=t.map(i=>({uuid:e,target:i,target_type:"Screenshot",name:"ShotSeen"}));return this.trackSearchActivity(a)},trackSearchProfileClicked(t,e=null){return this.trackSearchActivity({target:t,target_type:"User",name:"ProfileClicked"},e)},trackSearchDesignerBookmarked(t,e=null){return this.trackSearchActivity({target:t,target_type:"User",name:"DesignerBookmarked"},e)},trackSearchDesignersSeen(t,e){if(!t.length)return null;const a=t.map(i=>({uuid:e,target:i,target_type:"User",name:"DesignerSeen"}));return this.trackSearchActivity(a)},trackSearchServicesSeen(t,e){if(!t.length)return null;const a=t.map(i=>({uuid:e,target:i,target_type:"ServiceOffering",name:"ServiceSeen"}));return this.trackSearchActivity(a)},trackSearchActivity(t,e=null){if(!t)return;const i=(Array.isArray(t)?t:[t]).reduce((r,n)=>{n.uuid||(n.uuid=u.get(e)),n.ab_tests||(n.ab_tests=this.getABTestValues());const c=["uuid","target","target_type","name","ab_tests"],s=Object.keys(n);return s.length===c.length&&s.every(o=>c.includes(o))&&r.push(n),r},[]);if(i.length!==0)return fetch("/client_app/search_results",{body:JSON.stringify({events:i}),headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCSRFToken()},method:"POST"})}};export{h as I,u as S,d as t};
//# sourceMappingURL=internal-tracking-53a35615.js.map
